
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Introduction to Numerical Solution of Differential Equations &#8212; Mathemtaical Methods for Chemical Engineering</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Coupled Differential Equations" href="16-coupled-odes.html" />
    <link rel="prev" title="Method of Undetermined Coefficients (sec 2.9)" href="14-MoUC-VoP.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Mathemtaical Methods for Chemical Engineering</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Lecture notes for CMU 06-262 Math Methods in Chemical Engineering (Zachary Ulissi, CMU)
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Course Notes
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../linear_algebra/linear_algebra.html">
   Linear Algebra
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../linear_algebra/1-intro-matrices.html">
     Introduction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../linear_algebra/2-matrix-manipulation.html">
     Note on HW expectations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../linear_algebra/3-gauss-elimination.html">
     Return to Systems of Equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../linear_algebra/4-rank-gauss-examples.html">
     Chemical Engineering example solved with Gauss elimination
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../linear_algebra/5-determinants.html">
     Using the inverse of A to solve a system of linear equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../linear_algebra/6-eigenvalues-1.html">
     Homogeneous vs. Non-homogeneous Systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../linear_algebra/7-eigenvalue-2-difference-equations.html">
     <span class="math notranslate nohighlight">
      \(\underline{Ex}\)
     </span>
     : Symmetric matrix (
     <span class="math notranslate nohighlight">
      \(\lambda\)
     </span>
     always real)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../linear_algebra/7b-numerical-eigenvalues.html">
     Eigenvectors in python
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="ordinary_differential_equations.html">
   Ordinary Differential Equations
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="8-differential-equations.html">
     Differential Equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="9-exact-ode.html">
     Recap
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="10-linear-ode.html">
     Integrating Factors - Recap
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="11-linear-ode-example.html">
     Alternate Method (Last class continued)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="12-second-order-odes.html">
     Second Order Differential Equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="13-non-homogeneous-linear-odes.html">
     Recap from last class
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="14-MoUC-VoP.html">
     Method of Undetermined Coefficients (sec 2.9)
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Introduction to Numerical Solution of Differential Equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="16-coupled-odes.html">
     Coupled Differential Equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="17-coupled-ode-continued.html">
     Recap for coupled differential equations:
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="18-nonlinear-coupled-ODEs.html">
     Nonlinear coupled ODE’s
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="19-linear-stability.html">
     Steady states in Non-Linear Coupled ODE’s
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="20-BVP.html">
     Boundary Value Problems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="21-BVP-shooting-method.html">
     The Shooting Method for Solving BVPs
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../partial_differential_equations/partial_differential_equations.html">
   Partial Differential Equations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../partial_differential_equations/22-Intro-PDEs.html">
     Partial Differential Equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../partial_differential_equations/23-Fourier-Coefficients.html">
     Recap on PDEs from last lecture
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../statistics/statistics.html">
   Statistics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../statistics/24-intro-statistics.html">
     Intro to engineering statistics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../statistics/25-statistics-continue-linear-regression.html">
     Recap from last class
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../statistics/26-bonus-nonlinear-regression.html">
     Recap on linear regression
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../course-recap.html">
   06-262 Math Methods Recap
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/ulissigroup/math-methods-chemical-engineering/main?urlpath=lab/tree/math-methods-chemical-engineering/notes/ordinary_differential_equations/15-springs-numerical-odes.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/ulissigroup/math-methods-chemical-engineering/blob/main/math-methods-chemical-engineering/notes/ordinary_differential_equations/15-springs-numerical-odes.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ulissigroup/math-methods-chemical-engineering"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ulissigroup/math-methods-chemical-engineering/issues/new?title=Issue%20on%20page%20%2Fnotes/ordinary_differential_equations/15-springs-numerical-odes.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/notes/ordinary_differential_equations/15-springs-numerical-odes.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Introduction to Numerical Solution of Differential Equations
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#benefits-of-analytical-numerical-methods">
     Benefits of analytical/numerical methods
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#review-of-taylor-expansions">
     Review of Taylor Expansions
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#euler-s-method">
     Euler’s Method
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-integrate-to-t-2-for-y-y-using-euler-s-method">
     Example: integrate to t=2 for
     <span class="math notranslate nohighlight">
      \(y'=-y\)
     </span>
     using Euler’s method
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stepsize-of-1">
       Stepsize of 1
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stepsize-of-1-2">
     stepsize of 1/2
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#implementation-of-euler-s-method-in-python">
     Implementation of Euler’s method in python
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#realistic-method-runge-kutta">
     Realistic Method: Runge-Kutta
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#numerical-integration-in-scipy">
   Numerical integration in scipy
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#troubleshooting-solve-ivp-and-extra-options">
     Troubleshooting solve_ivp and extra options
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tolerances">
       Tolerances
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#failures-in-integration-with-rk45">
       Failures in integration with RK45
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#practical-tips">
     Practical tips:
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#intuition-for-second-order-linear-ode-s-spring-example">
   Intuition for second order linear ODE’s: spring example
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simple-spring">
     Simple spring
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spring-with-drag">
     Spring with drag
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#driving-force">
     Driving force
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bonus-methods-to-help-understand-where-runge-kutta-comes-from">
   Bonus methods to help understand where Runge-Kutta comes from
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#euler-s-method-with-second-derivatives">
     Euler’s method with second derivatives
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#example-with-second-order">
       Example with second order
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#python-implementation-of-the-second-order-euler-method">
       Python implementation of the second order Euler method
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mid-point-method">
     Mid-point method
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#python-implementation-of-the-mid-point-method">
       Python implementation of the mid-point method
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#numerical-taylor-expansions">
   Numerical Taylor expansions
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-of-taylor-expansion-in-python">
     Example of taylor expansion in python
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Introduction to Numerical Solution of Differential Equations</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Introduction to Numerical Solution of Differential Equations
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#benefits-of-analytical-numerical-methods">
     Benefits of analytical/numerical methods
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#review-of-taylor-expansions">
     Review of Taylor Expansions
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#euler-s-method">
     Euler’s Method
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-integrate-to-t-2-for-y-y-using-euler-s-method">
     Example: integrate to t=2 for
     <span class="math notranslate nohighlight">
      \(y'=-y\)
     </span>
     using Euler’s method
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#stepsize-of-1">
       Stepsize of 1
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stepsize-of-1-2">
     stepsize of 1/2
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#implementation-of-euler-s-method-in-python">
     Implementation of Euler’s method in python
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#realistic-method-runge-kutta">
     Realistic Method: Runge-Kutta
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#numerical-integration-in-scipy">
   Numerical integration in scipy
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#troubleshooting-solve-ivp-and-extra-options">
     Troubleshooting solve_ivp and extra options
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#tolerances">
       Tolerances
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#failures-in-integration-with-rk45">
       Failures in integration with RK45
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#practical-tips">
     Practical tips:
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#intuition-for-second-order-linear-ode-s-spring-example">
   Intuition for second order linear ODE’s: spring example
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simple-spring">
     Simple spring
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#spring-with-drag">
     Spring with drag
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#driving-force">
     Driving force
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bonus-methods-to-help-understand-where-runge-kutta-comes-from">
   Bonus methods to help understand where Runge-Kutta comes from
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#euler-s-method-with-second-derivatives">
     Euler’s method with second derivatives
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#example-with-second-order">
       Example with second order
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#python-implementation-of-the-second-order-euler-method">
       Python implementation of the second order Euler method
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mid-point-method">
     Mid-point method
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#python-implementation-of-the-mid-point-method">
       Python implementation of the mid-point method
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#numerical-taylor-expansions">
   Numerical Taylor expansions
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-of-taylor-expansion-in-python">
     Example of taylor expansion in python
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <p>{{ badge }}
$<span class="math notranslate nohighlight">\(\newcommand{\arr}[1]{\underline{\underline{#1}}}\)</span><span class="math notranslate nohighlight">\(    
\)</span><span class="math notranslate nohighlight">\(\newcommand{\vec}[1]{\underline{#1}}\)</span><span class="math notranslate nohighlight">\(   
\)</span><span class="math notranslate nohighlight">\(\require{mhchem}\)</span>$</p>
<section class="tex2jax_ignore mathjax_ignore" id="introduction-to-numerical-solution-of-differential-equations">
<h1>Introduction to Numerical Solution of Differential Equations<a class="headerlink" href="#introduction-to-numerical-solution-of-differential-equations" title="Permalink to this headline">#</a></h1>
<ul class="simple">
<li><p>We’ll start with simple <span class="math notranslate nohighlight">\(1^\circ\)</span> ODE Initial Value Problem (IVP)</p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-fb689bb9-8960-485e-9532-c7041af8aa35">
<span class="eqno">(353)<a class="headerlink" href="#equation-fb689bb9-8960-485e-9532-c7041af8aa35" title="Permalink to this equation">#</a></span>\[\begin{align}
\frac{dy}{dt} = -y, &amp;&amp; y(t=0) = 1
\end{align}\]</div>
<p>We’ve solved this already</p>
<div class="amsmath math notranslate nohighlight" id="equation-7ddca1af-337d-485b-ba18-c2f6322b73d1">
<span class="eqno">(354)<a class="headerlink" href="#equation-7ddca1af-337d-485b-ba18-c2f6322b73d1" title="Permalink to this equation">#</a></span>\[\begin{align}
y = \exp(-x)
\end{align}\]</div>
<ul class="simple">
<li><p>How would you do this without being able to solve differential equation? The Taylor expansion is a related concept, so let’s quickly review that.</p></li>
</ul>
<p>For today, we’re going to solve differential equations of the form</p>
<div class="amsmath math notranslate nohighlight" id="equation-3b89f55f-e579-4d1b-a605-ff4e2357c3be">
<span class="eqno">(355)<a class="headerlink" href="#equation-3b89f55f-e579-4d1b-a605-ff4e2357c3be" title="Permalink to this equation">#</a></span>\[\begin{align}
\frac{dy}{dt}=f(t, y)
\end{align}\]</div>
<section id="benefits-of-analytical-numerical-methods">
<h2>Benefits of analytical/numerical methods<a class="headerlink" href="#benefits-of-analytical-numerical-methods" title="Permalink to this headline">#</a></h2>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Analytical</p></th>
<th class="head"><p>Numerical</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>+ exact solution</p></td>
<td><p>- approximation to real solution</p></td>
</tr>
<tr class="row-odd"><td><p>+ tells you which parameters are important</p></td>
<td><p>- black box</p></td>
</tr>
<tr class="row-even"><td><p>+ functional form (engineering insight)</p></td>
<td><p>- hard to check if answer is correct</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>solve for all parameters | - programming bugs</p></li>
</ul>
<ul class="simple">
<li><p>slow (can take days to work out solution) | + fast to implement</p></li>
<li><p>Algebra mistakes | + solve very hard equations</p></li>
<li><p>Still have to plot a solution at end | + good to solve engineering problems at specific set of parameters etc.
- very hard for complicated ODE’s</p></li>
</ul>
<p>Places where you will use these skills:</p>
<ul class="simple">
<li><p>Homework in this class</p></li>
<li><p>Group project</p></li>
<li><p><strong>Reactor engineering (A LOT)</strong></p></li>
<li><p>Heat/Mass Transfer</p></li>
<li><p>Process Control</p></li>
<li><p>MS Core courses (if you do the 5th year MS!)</p></li>
</ul>
</section>
<section id="review-of-taylor-expansions">
<h2>Review of Taylor Expansions<a class="headerlink" href="#review-of-taylor-expansions" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>We have a complicated function (based on info at one point) that we want to  approximate. The Taylor series is a polynomial approxiamation of <span class="math notranslate nohighlight">\(f\)</span>:</p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-5df7f94d-503f-4864-8fd0-f086bcff81c9">
<span class="eqno">(356)<a class="headerlink" href="#equation-5df7f94d-503f-4864-8fd0-f086bcff81c9" title="Permalink to this equation">#</a></span>\[\begin{align}
\hat{f} = a + bx + cx^2 + dx^3
\end{align}\]</div>
<p>The simplest approximation is <span class="math notranslate nohighlight">\(\hat{f} = a\)</span>. Let’s demonstrate with <span class="math notranslate nohighlight">\(f(x) = \exp(x)\)</span></p>
<ul class="simple">
<li><p>Each coefficient is obtained by matching derivatives</p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-1936c50e-60e6-4a34-bc00-96d2fff67a54">
<span class="eqno">(357)<a class="headerlink" href="#equation-1936c50e-60e6-4a34-bc00-96d2fff67a54" title="Permalink to this equation">#</a></span>\[\begin{align}
\hat{f}(x=0) = a = f(x=0)\\
\frac{d\hat{f}}{dx}\bigg|_{x=0} = b = \frac{df}{dx}\bigg|_{x=0}\\
\frac{d^2\hat{f}}{dx^2}\bigg|_{x=0} = 2c = \frac{d^2}{dx^2}\bigg|_{x=0}
\end{align}\]</div>
<p>And so on..</p>
</section>
<section id="euler-s-method">
<h2>Euler’s Method<a class="headerlink" href="#euler-s-method" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Simplest possible scheme - use the Taylor expansion to move from one point to the next for integrating. Start with definition of derivative:</p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-40148202-d540-45cd-8717-a93162068f43">
<span class="eqno">(358)<a class="headerlink" href="#equation-40148202-d540-45cd-8717-a93162068f43" title="Permalink to this equation">#</a></span>\[\begin{align}
\frac{dy}{dt}\bigg|_{t=0} = \frac{y(t=h) - y(t=0)}{h - 0}\\
\frac{dy}{dt}\bigg|_{t=0} = \frac{y(t_1) - y(t_0)}{t_1 - t_0}
\end{align}\]</div>
<p>Let’s rearrange</p>
<div class="amsmath math notranslate nohighlight" id="equation-41673ebc-9f7e-4149-8c45-53368eb46137">
<span class="eqno">(359)<a class="headerlink" href="#equation-41673ebc-9f7e-4149-8c45-53368eb46137" title="Permalink to this equation">#</a></span>\[\begin{align}
y(t_1) = \frac{dy}{dt}\bigg|_{t_0}(t_1-t_0) + y(t_0) \ \rightarrow \text{  ODE gives us this!}
\end{align}\]</div>
<p><span class="math notranslate nohighlight">\(\underline{\text{Ex}}\)</span> : <span class="math notranslate nohighlight">\(\frac{dy}{dt} = - y\)</span>,  <span class="math notranslate nohighlight">\(\hspace{1cm}y(t=0) = 1\)</span></p>
<div class="amsmath math notranslate nohighlight" id="equation-14ec2698-b9c7-4456-80ab-f6d3623fe743">
<span class="eqno">(360)<a class="headerlink" href="#equation-14ec2698-b9c7-4456-80ab-f6d3623fe743" title="Permalink to this equation">#</a></span>\[\begin{align}
y(t&amp;=0) = 1\\
y(t_1) &amp;= \frac{dy}{dt}\bigg|_{t=0} (t_1 - 0) + y(t = 0)\\
&amp;= -y \bigg|_{t=0}t_1 + 1
\end{align}\]</div>
<p>Evaluate error for Euler approximation</p>
<div class="amsmath math notranslate nohighlight" id="equation-52b70f9f-d913-45f7-b911-a0cb9af538dd">
<span class="eqno">(361)<a class="headerlink" href="#equation-52b70f9f-d913-45f7-b911-a0cb9af538dd" title="Permalink to this equation">#</a></span>\[\begin{align}
y(t) = \exp(-t) \leftarrow \text{  known}\\
y(\Delta t) = y(0) + \Delta t \frac{dy}{dt}\bigg|_{t=0} + \frac{\Delta t^2}{2} \frac{d^2y}{dt^2}\bigg|_{t=0} + ...\\
\frac{y(\Delta t) - y(0)}{\Delta t} = \frac{dy}{dt}\bigg|_{t=0} + \frac{\Delta t}{2} \frac{d^2y}{dt^2}\bigg|_{t=0} + ...
\end{align}\]</div>
<p>We are neglecting the second order terms and beyond. Error decays proportional to <span class="math notranslate nohighlight">\(\Delta t\)</span>!</p>
</section>
<section id="example-integrate-to-t-2-for-y-y-using-euler-s-method">
<h2>Example: integrate to t=2 for <span class="math notranslate nohighlight">\(y'=-y\)</span> using Euler’s method<a class="headerlink" href="#example-integrate-to-t-2-for-y-y-using-euler-s-method" title="Permalink to this headline">#</a></h2>
<section id="stepsize-of-1">
<h3>Stepsize of 1<a class="headerlink" href="#stepsize-of-1" title="Permalink to this headline">#</a></h3>
<p><span class="math notranslate nohighlight">\(t=0, y(0)=1\)</span></p>
<p>dy/dt (t=0) = -1</p>
<p>y(t=1) = -1 * 1 + 1 = 0</p>
<p>y = e^-1</p>
<p>y(t=2) = -0 * 1 + 0 = 0</p>
<p>y = e^(-2)</p>
</section>
</section>
<section id="stepsize-of-1-2">
<h2>stepsize of 1/2<a class="headerlink" href="#stepsize-of-1-2" title="Permalink to this headline">#</a></h2>
<p>t = 0 -&gt; t=1/2</p>
<p>y(t=1/2) = -y(t=0) * 1/2 + y(t=0) = -1*1/2 + 1 = 1/2</p>
<p>y(t=1) = -y(t=1/2) * 1/2 + y(t=1/2) = -1/2 * 1/2 + 1/2 = 1/4</p>
<p>y(t=3/2) = -y(t=1) * 1/2 + y(t=1) = -1/4 * 1/2 + 1/4 = 1/8</p>
<p>y(t=2) = -y(t=3/2) * 1/2 + y(t=3/2) = -1/8*1/2 + 1/8 = 1/16</p>
</section>
<section id="implementation-of-euler-s-method-in-python">
<h2>Implementation of Euler’s method in python<a class="headerlink" href="#implementation-of-euler-s-method-in-python" title="Permalink to this headline">#</a></h2>
<p>First, let’s define a function that represents what we want to integrate, of the form <span class="math notranslate nohighlight">\(y'=F(t,y)\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the function we want to integrate</span>
<span class="k">def</span> <span class="nf">yprime</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
  <span class="k">return</span> <span class="o">-</span><span class="n">y</span>

<span class="c1"># try y&#39; at t=0, y=1</span>
<span class="n">yprime</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.5
</pre></div>
</div>
</div>
</div>
<p>Now, we will write a function that loops through a range of times, and keeps adding the slope each time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">euler_integrate</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">y0</span><span class="p">):</span>
  <span class="c1"># func: the function to integrate, of the form</span>
  <span class="c1">#       y&#39;=F(t,y)</span>
  <span class="c1"># y0:   the initial function value</span>
  <span class="c1"># t:    the range of times to evaluate</span>

  <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y0</span><span class="p">]</span>
  <span class="n">dt</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

  <span class="c1">#Loop through and implement the update</span>
  <span class="k">for</span> <span class="n">new_time</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>

    <span class="c1"># current y</span>
    <span class="n">current_y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">#Get the current derivative</span>
    <span class="n">yprime</span><span class="o">=</span><span class="n">func</span><span class="p">(</span><span class="n">new_time</span><span class="p">,</span><span class="n">current_y</span><span class="p">)</span>

    <span class="c1">#Update y, fill this in</span>
    <span class="n">updated_y</span> <span class="o">=</span> <span class="n">yprime</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="n">current_y</span>

    <span class="c1">#Save the y</span>
    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">updated_y</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s test this function for a step size of 0.5</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate a range of t from 0 to 2, with a timestep of 0.5</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.1</span><span class="p">,</span><span class="mf">.01</span><span class="p">)</span>

<span class="c1"># Use or ne function</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">euler_integrate</span><span class="p">(</span><span class="n">yprime</span><span class="p">,</span> 
                    <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> 
                    <span class="n">y0</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1">#Plot the results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Numerical Sol&#39;&#39;n to dy/dt=-y, y(t=0)=1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Numerical Sol&#39;&#39;n to dy/dt=-y, y(t=0)=1&#39;</span><span class="p">)</span>

<span class="n">t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">),</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;full solution, $e^{-t}$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Generate a range of t from 0 to 2, with a timestep of 0.5</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.1</span><span class="p">,</span><span class="mf">.01</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># Use or ne function</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">y</span> <span class="o">=</span> <span class="n">euler_integrate</span><span class="p">(</span><span class="n">yprime</span><span class="p">,</span> 
<span class="g g-Whitespace">      </span><span class="mi">6</span>                     <span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> 
<span class="g g-Whitespace">      </span><span class="mi">7</span>                     <span class="n">y0</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;np&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Let’s play around with the step size and see how the error at t=2 changes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.01</span><span class="p">,</span><span class="mf">0.0001</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">euler_integrate</span><span class="p">(</span><span class="n">yprime</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error of f(x=2) = </span><span class="si">%f</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">abs</span>(y[-1]-np.exp(-t[-1])))
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Error of f(x=2) = 0.000013
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Scan over a range of time steps</span>

<span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mf">.5</span><span class="p">,</span><span class="mf">.1</span><span class="p">,</span><span class="mf">.05</span><span class="p">,</span><span class="mf">.01</span><span class="p">]:</span>

  <span class="c1"># Calculate the solution</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.01</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">euler_integrate</span><span class="p">(</span><span class="n">yprime</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

  <span class="c1"># Plot the error (difference beteween analytical </span>
  <span class="c1"># solution and numerical solution)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span><span class="s1">&#39;ok&#39;</span><span class="p">)</span>

<span class="c1"># Plot a simple -1 log scaling to show the error drops</span>
<span class="n">dt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="n">dt</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Slope 1&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time Step&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error at t=2 for y</span><span class="se">\&#39;</span><span class="s1">=-y, y(0)=1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f72a128ac10&gt;
</pre></div>
</div>
<img alt="../../_images/15-springs-numerical-odes_22_1.png" src="../../_images/15-springs-numerical-odes_22_1.png" />
</div>
</div>
</section>
<section id="realistic-method-runge-kutta">
<h2>Realistic Method: Runge-Kutta<a class="headerlink" href="#realistic-method-runge-kutta" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>There are many possible ways to approximate these differential equations. Euler is very simple and not widely used in practice. Two other methods are implemented below in the notes if you’re interested; they’re better than Euler but worse than what I’m about to show you.</p></li>
<li><p>Which method you use depends on your problem and limitations/constraints.</p></li>
<li><p>The Runge-Kutta method works very well and is widely used in practice, and is a reasonable trade-off in Order, complexity, speed etc. This is an <span class="math notranslate nohighlight">\(O(\Delta t^4)\)</span> method - extemely powerful.<br />
Def:</p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-9fdb66e3-bd3f-45b4-8952-8e798b6157fe">
<span class="eqno">(362)<a class="headerlink" href="#equation-9fdb66e3-bd3f-45b4-8952-8e798b6157fe" title="Permalink to this equation">#</a></span>\[\begin{align}
k_1 &amp;= \Delta t \cdot f(t^N, y^N)\\
k_2 &amp;= \Delta t \cdot f\left(t^N+\frac{\Delta t}{2}, y^N + \frac{k_1}{2}\right)\\
k_3 &amp;= \Delta t \cdot f\left(t^N+\frac{\Delta t}{2}, y^N + \frac{k_2}{2}\right)\\
k_4 &amp;= \Delta t \cdot f(t^N+\Delta t, y^N + k_3)\\
y^{N+1} &amp;= y^N + \frac{k_1}{6} + \frac{k_2}{3} + \frac{k_3}{3} +  \frac{k_4}{6}
\end{align}\]</div>
<p>Remember f(t, y) is the ODE!</p>
<p>Very similar to ODE45 in Matlab if you’ve ever used that.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="numerical-integration-in-scipy">
<h1>Numerical integration in scipy<a class="headerlink" href="#numerical-integration-in-scipy" title="Permalink to this headline">#</a></h1>
<ul class="simple">
<li><p>scipy contains a well-rounded ODE integration method <code class="docutils literal notranslate"><span class="pre">scipy.integrate.solve_ivp</span></code>. It works pretty much the same as the other methods we’ve seen in terms of functional form. Linke here: https://docs.scipy.org/doc/scipy/reference/generated/scipy.integrate.solve_ivp.html#scipy.integrate.solve_ivp</p></li>
<li><p>The only additional trick is that this method can figure out a reasonable guess for the step size</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>

<span class="k">def</span> <span class="nf">yprime</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
  <span class="k">return</span> <span class="o">-</span><span class="n">y</span>

<span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">yprime</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span><span class="s1">&#39;ok&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;solve_ivp&#39;</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">),</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;full solution, $e^{-t}$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f72a14e8290&gt;
</pre></div>
</div>
<img alt="../../_images/15-springs-numerical-odes_26_1.png" src="../../_images/15-springs-numerical-odes_26_1.png" />
</div>
</div>
<p>We can also do the same thing and get it to evaluate at a bunch of points.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>

<span class="c1"># The differential equation function - has to be f(t,y)!</span>
<span class="k">def</span> <span class="nf">yprime</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
  <span class="k">return</span> <span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">y</span>

<span class="c1"># Let&#39;s specify the range over which we want regular spaced solutions</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>

<span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">yprime</span><span class="p">,</span> <span class="c1"># the function to integrate</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="c1"># the time range to integrate over</span>
                <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="c1"># the initial condition; it&#39;s a vector because solve_ivp is actually set up for coupled ODEs</span>
                <span class="n">t_eval</span><span class="o">=</span><span class="n">t</span><span class="p">,</span><span class="c1"># if we want it to evaluate the solution at regular points</span>
                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,))</span> 

<span class="c1"># Plot the solution - note that sol.t is where the solution was actually evaluated</span>
<span class="c1"># and sol.y is the solution. We take the first row of the solution here, since </span>
<span class="c1"># solve_ivp is really set up to solve systems of equations</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span>
         <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> 
         <span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="c1"># black circles</span>
         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;solve_ivp&#39;</span><span class="p">,</span>
         <span class="p">)</span>

<span class="c1"># Plot the analytical solution</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="p">),</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;full solution, $e^{-t}$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f72a1481b10&gt;
</pre></div>
</div>
<img alt="../../_images/15-springs-numerical-odes_28_1.png" src="../../_images/15-springs-numerical-odes_28_1.png" />
</div>
</div>
<section id="troubleshooting-solve-ivp-and-extra-options">
<h2>Troubleshooting solve_ivp and extra options<a class="headerlink" href="#troubleshooting-solve-ivp-and-extra-options" title="Permalink to this headline">#</a></h2>
<section id="tolerances">
<h3>Tolerances<a class="headerlink" href="#tolerances" title="Permalink to this headline">#</a></h3>
<p>solve_ivp is trying to estimate and control the error for you! rtol is the relative tolerance in the function (eg % error in the numbers coming out).</p>
<ul class="simple">
<li><p>atol is the absolute tolerance (I want the concentration +/- 0.00001).</p></li>
<li><p>rtol is <span class="math notranslate nohighlight">\(10^{-3}\)</span> and atols is <span class="math notranslate nohighlight">\(10^{-6}\)</span>.</p></li>
<li><p>If your concentration is on the scale of 0.000000001 M, you will have a problem!</p>
<ul>
<li><p>Best solution - change units or rescale your problem so your variables are close to 1</p></li>
<li><p>Possible solution - make you atol really small and hope it solves things</p></li>
</ul>
</li>
<li><p>If decreasing rtol/atol changes your solution, they’re not set tightly enough or you have other problems!</p></li>
</ul>
</section>
<section id="failures-in-integration-with-rk45">
<h3>Failures in integration with RK45<a class="headerlink" href="#failures-in-integration-with-rk45" title="Permalink to this headline">#</a></h3>
<p>The solve_ivp documentation has some nice comments for what to do it things go wrong:</p>
<p><code class="docutils literal notranslate"><span class="pre">If</span> <span class="pre">not</span> <span class="pre">sure,</span> <span class="pre">first</span> <span class="pre">try</span> <span class="pre">to</span> <span class="pre">run</span> <span class="pre">‘RK45’.</span> <span class="pre">If</span> <span class="pre">it</span> <span class="pre">makes</span> <span class="pre">unusually</span> <span class="pre">many</span> <span class="pre">iterations,</span> <span class="pre">diverges,</span> <span class="pre">or</span> <span class="pre">fails,</span> <span class="pre">your</span> <span class="pre">problem</span> <span class="pre">is</span> <span class="pre">likely</span> <span class="pre">to</span> <span class="pre">be</span> <span class="pre">stiff</span> <span class="pre">and</span> <span class="pre">you</span> <span class="pre">should</span> <span class="pre">use</span> <span class="pre">‘Radau’</span> <span class="pre">or</span> <span class="pre">‘BDF’.</span> <span class="pre">‘LSODA’</span> <span class="pre">can</span> <span class="pre">also</span> <span class="pre">be</span> <span class="pre">a</span> <span class="pre">good</span> <span class="pre">universal</span> <span class="pre">choice,</span> <span class="pre">but</span> <span class="pre">it</span> <span class="pre">might</span> <span class="pre">be</span> <span class="pre">somewhat</span> <span class="pre">less</span> <span class="pre">convenient</span> <span class="pre">to</span> <span class="pre">work</span> <span class="pre">with</span> <span class="pre">as</span> <span class="pre">it</span> <span class="pre">wraps</span> <span class="pre">old</span> <span class="pre">Fortran</span> <span class="pre">code</span></code></p>
</section>
</section>
<section id="practical-tips">
<h2>Practical tips:<a class="headerlink" href="#practical-tips" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Very important to check whether the answer is reasonable</p></li>
<li><p>If you solve a problem with <span class="math notranslate nohighlight">\(\Delta t = 0.1\)</span> (or some other number), always check that your answer does not change with <span class="math notranslate nohighlight">\(\Delta t = \frac{0.1}{2}\)</span></p></li>
<li><p>Before solving a problem with numerical methods, make sure you can correctly code the RHS of the equation.</p></li>
<li><p>If you are getting strange results, try a stiff solver instead. See the notes in t</p></li>
</ul>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="intuition-for-second-order-linear-ode-s-spring-example">
<h1>Intuition for second order linear ODE’s: spring example<a class="headerlink" href="#intuition-for-second-order-linear-ode-s-spring-example" title="Permalink to this headline">#</a></h1>
<section id="simple-spring">
<h2>Simple spring<a class="headerlink" href="#simple-spring" title="Permalink to this headline">#</a></h2>
<p>You probably solved oscillating springs in your physics class. As a reminder,</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
F=ma=m\frac{d^2x}{dt^2}
\end{align*}\]</div>
<p>A spring is defined by a restoring force $<span class="math notranslate nohighlight">\(F=-kx\)</span>$. Without any other forces, this leads to</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
m\frac{d^2x}{dt^2}=-kx
\end{align*}\]</div>
<p>or</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
x''=-\frac{k}{m}x
\end{align*}\]</div>
<p>We can solve this! We know the solution is \begin{align*}
x=A\sin\left(\sqrt{\frac{k}{m}}x\right)+B\cos\left(\sqrt{\frac{k}{m}}x\right)
\end{align*}
We recover the spring oscillation right away.</p>
</section>
<section id="spring-with-drag">
<h2>Spring with drag<a class="headerlink" href="#spring-with-drag" title="Permalink to this headline">#</a></h2>
<p>Let’s consider a spring with a drag force on the end, which is proportional to how quick the weight is moving. Now we have</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
m\frac{d^2x}{dt^2}=-kx-c\frac{dx}{dt}
\end{align*}\]</div>
<p>We can solve this too! Rearranging:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{d^2x}{dt^2}+\frac{c}{m}\frac{dx}{dt}+\frac{k}{m}x=0
\end{align*}\]</div>
<p>Rather than solve all of these by hand, let’s just do it numerically. Suppose <span class="math notranslate nohighlight">\(m=1\)</span> kg, <span class="math notranslate nohighlight">\(k=5\)</span> kg/s<span class="math notranslate nohighlight">\(^2\)</span>. The initial condition is x=0 and <span class="math notranslate nohighlight">\(x'=5\)</span> m/s.</p>
<p>Solve and plot for the solution with c=0 kg/s and c=1 kg/s. Try varying c. What happens if c gets large?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="c1">#y, y&#39;</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">yprime</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
  <span class="n">y</span><span class="p">,</span> <span class="n">yprime</span> <span class="o">=</span> <span class="n">y</span> 

  <span class="k">return</span> <span class="p">[</span><span class="n">yprime</span><span class="p">,</span> <span class="c1">#dy/dx = y&#39;</span>
          <span class="o">-</span><span class="n">c</span><span class="o">/</span><span class="n">m</span><span class="o">*</span><span class="n">yprime</span><span class="o">-</span><span class="n">k</span><span class="o">/</span><span class="n">m</span><span class="o">*</span><span class="n">y</span> <span class="p">]</span> <span class="c1">#dyprime/dx = y&#39;&#39;</span>

<span class="n">t_eval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>


<span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">yprime</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t_eval</span> <span class="o">=</span> <span class="n">t_eval</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span> <span class="c1">#plot only the first column of solutions e.g. y&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.lines.Line2D at 0x7f72a0f1ecd0&gt;]
</pre></div>
</div>
<img alt="../../_images/15-springs-numerical-odes_31_1.png" src="../../_images/15-springs-numerical-odes_31_1.png" />
</div>
</div>
<p>Now, let’s add some damping to this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="c1">#y, y&#39;</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">yprime</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
  <span class="n">y</span><span class="p">,</span> <span class="n">yprime</span> <span class="o">=</span> <span class="n">y</span> 

  <span class="k">return</span> <span class="p">[</span><span class="n">yprime</span><span class="p">,</span> <span class="c1">#dy/dx = y&#39;</span>
          <span class="o">-</span><span class="n">c</span><span class="o">/</span><span class="n">m</span><span class="o">*</span><span class="n">yprime</span><span class="o">-</span><span class="n">k</span><span class="o">/</span><span class="n">m</span><span class="o">*</span><span class="n">y</span> <span class="p">]</span> <span class="c1">#dyprime/dx = y&#39;&#39;</span>

<span class="n">t_eval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>


<span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">yprime</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t_eval</span> <span class="o">=</span> <span class="n">t_eval</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span> <span class="c1">#plot only the first column of solutions e.g. y&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>If we make <span class="math notranslate nohighlight">\(c\)</span> too large, we get under-damped behavior!</p>
</section>
<section id="driving-force">
<h2>Driving force<a class="headerlink" href="#driving-force" title="Permalink to this headline">#</a></h2>
<p>Now, let’s add an external force.</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
m\frac{d^2x}{dt^2}=-kx-c\frac{dx}{dt}+F(t)
\end{align*}\]</div>
<p>Rearranging:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\frac{d^2x}{dt^2}+\frac{c}{m}\frac{dx}{dt}+\frac{k}{m}x=\frac{F(t)}{m}
\end{align*}\]</div>
<p>Try solving and plotting for <span class="math notranslate nohighlight">\(F(t)=\sin(t)\)</span> and <span class="math notranslate nohighlight">\(F(t)=100\sin(8t)\)</span>.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="bonus-methods-to-help-understand-where-runge-kutta-comes-from">
<h1>Bonus methods to help understand where Runge-Kutta comes from<a class="headerlink" href="#bonus-methods-to-help-understand-where-runge-kutta-comes-from" title="Permalink to this headline">#</a></h1>
<section id="euler-s-method-with-second-derivatives">
<h2>Euler’s method with second derivatives<a class="headerlink" href="#euler-s-method-with-second-derivatives" title="Permalink to this headline">#</a></h2>
<p>We truncated the approximation at the first derivative in the Euler scheme. An obvious question is whether using the second derivative would improve things?</p>
<p>For example, let’s propose a new method:</p>
<div class="amsmath math notranslate nohighlight" id="equation-92dc3a96-7136-41aa-822d-7c6150d3885c">
<span class="eqno">(363)<a class="headerlink" href="#equation-92dc3a96-7136-41aa-822d-7c6150d3885c" title="Permalink to this equation">#</a></span>\[\begin{align}
y(t) - y(t_0) = \Delta t \frac{dy}{dt}\bigg|_{t = t_0} + \frac{\Delta t^2}{2} \frac{d^2y}{dt^2}\bigg|_{t = t_0}
\end{align}\]</div>
<p>We have a new term, if we know <span class="math notranslate nohighlight">\(\frac{d^2y}{dt^2}\bigg|_{t=t_0}\)</span>. Now the order should be better as <span class="math notranslate nohighlight">\(\Delta t^2\)</span></p>
<section id="example-with-second-order">
<h3>Example with second order<a class="headerlink" href="#example-with-second-order" title="Permalink to this headline">#</a></h3>
<p><span class="math notranslate nohighlight">\(y(t_1) = -t + 1\)</span><br />
or more generally:</p>
<div class="amsmath math notranslate nohighlight" id="equation-3008f1af-dd3e-49c2-9fcb-cb429c6df5a2">
<span class="eqno">(364)<a class="headerlink" href="#equation-3008f1af-dd3e-49c2-9fcb-cb429c6df5a2" title="Permalink to this equation">#</a></span>\[\begin{align}
y(t_1) = -y (t_0) (t_1 - t_0) + y(t_0)
\end{align}\]</div>
<p>Remember, this only really holds for <span class="math notranslate nohighlight">\(t_1 - t_0 \rightarrow 0\)</span></p>
<img src="https://docs.google.com/drawings/d/e/2PACX-1vSgJC6gobNTNfiWxOfOGH1RhSYBz1tefW9Nbmbdul4yPxR7FZjQBe1bfFgy_SaWqiYI6c4Y7nwg2ryw/pub?w=558&h=283"></section>
<section id="python-implementation-of-the-second-order-euler-method">
<h3>Python implementation of the second order Euler method<a class="headerlink" href="#python-implementation-of-the-second-order-euler-method" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the function we want to integrate</span>
<span class="k">def</span> <span class="nf">yprime_yprimeprime</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
  <span class="c1">#return y&#39;, y&#39;&#39;</span>
  <span class="k">return</span> <span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span>


<span class="k">def</span> <span class="nf">euler_2nd_derivative_integrate</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">y0</span><span class="p">):</span>

  <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y0</span><span class="p">]</span>
  <span class="n">current_time</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">dt</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

  <span class="c1">#Loop through and implement the update</span>
  <span class="k">for</span> <span class="n">new_time</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>

    <span class="n">current_y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">#Get the current derivative</span>
    <span class="n">yprime</span><span class="p">,</span> <span class="n">yprimeprime</span><span class="o">=</span><span class="n">func</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">current_y</span><span class="p">)</span>

    <span class="c1">#Find the current step size</span>
    <span class="n">updated_y</span> <span class="o">=</span> <span class="n">current_y</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">yprime</span> <span class="o">+</span> <span class="n">dt</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">yprimeprime</span>

    <span class="c1">#Save the y</span>
    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">updated_y</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">y</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">euler_integrate</span><span class="p">(</span><span class="n">yprime</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;1st-order Euler Sol&#39;&#39;n&#39;</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">euler_2nd_derivative_integrate</span><span class="p">(</span><span class="n">yprime_yprimeprime</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;or&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;2nd-order Euler Sol&#39;&#39;n&#39;</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">),</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;full solution, $e^{-t}$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f34480aa750&gt;
</pre></div>
</div>
<img alt="../../_images/15-springs-numerical-odes_41_1.png" src="../../_images/15-springs-numerical-odes_41_1.png" />
</div>
</div>
<p>Let’s see how accurate this new method is with respect to step size!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Scan over a range of time steps</span>

<span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mf">.5</span><span class="p">,</span><span class="mf">.1</span><span class="p">,</span><span class="mf">.05</span><span class="p">,</span><span class="mf">.01</span><span class="p">]:</span>

  <span class="c1"># Calculate the solution</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.01</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">euler_integrate</span><span class="p">(</span><span class="n">yprime</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

  <span class="c1"># Plot the error (difference beteween analytical </span>
  <span class="c1"># solution and numerical solution)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span><span class="s1">&#39;ok&#39;</span><span class="p">)</span>

  <span class="c1"># Calculate the solution</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.01</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">euler_2nd_derivative_integrate</span><span class="p">(</span><span class="n">yprime_yprimeprime</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

  <span class="c1"># Plot the error (difference beteween analytical </span>
  <span class="c1"># solution and numerical solution)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span><span class="s1">&#39;or&#39;</span><span class="p">)</span>

<span class="c1"># Plot a simple -1 log scaling to show the error drops</span>
<span class="n">dt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="n">dt</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;First order Euler&#39;</span><span class="p">)</span>

<span class="n">dt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="n">dt</span><span class="o">**</span><span class="mf">2.</span><span class="o">/</span><span class="mi">20</span><span class="p">,</span><span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Euler with 2nd Derivatives&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time Step&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error at t=2 for y</span><span class="se">\&#39;</span><span class="s1">=-y, y(0)=1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f344804cf10&gt;
</pre></div>
</div>
<img alt="../../_images/15-springs-numerical-odes_43_1.png" src="../../_images/15-springs-numerical-odes_43_1.png" />
</div>
</div>
</section>
</section>
<section id="mid-point-method">
<h2>Mid-point method<a class="headerlink" href="#mid-point-method" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>So, we have a method that allows us to integrate forward as long as our step size is small enough. However, we want the step size to be large to keep our method fast. What can we do to improve this?</p></li>
<li><p>We showed an example of a second order method if we know the second derivative to help in our Taylor series. We can so similarly well with other schemes.</p></li>
</ul>
<img src="https://docs.google.com/drawings/d/e/2PACX-1vRnHTAakWpLwYKmHHkSQtfEcBe9IYZse9Sz3DLt5paAkwYClrhBRzp88uAr4BxIFrn_2qA5YYmOhOhj/pub?w=460&amp;h=808"><p>The problem here is that <span class="math notranslate nohighlight">\(\frac{dy}{dt}\bigg|_{t=0}\)</span> is not a good approximation everywhere in the interval and expectedly at the end. So, let’s make a better approximation. Let’s take a step half way across the interval using the first approximation.</p>
<div class="amsmath math notranslate nohighlight" id="equation-971f36ea-4cc4-4fb3-bfa4-29bd71237ce3">
<span class="eqno">(365)<a class="headerlink" href="#equation-971f36ea-4cc4-4fb3-bfa4-29bd71237ce3" title="Permalink to this equation">#</a></span>\[\begin{align}
y(\Delta t) = y(0) + \Delta t \frac{dy}{dt} \bigg|_{t = \frac{\Delta t}{2}}\\
\frac{dy}{dt}\bigg|_{t = \frac{\Delta t}{2}} = \frac{dy}{dt}\bigg|_{t=0} + \left( \frac{\Delta t}{2}\right) \frac{d^2y}{dt^2}\bigg|_{t=0} + \frac{1}{2} \left( \frac{\Delta t}{2}\right)^2 \frac{d^3y}{dt^3}\bigg|_{t=0} + ...\\
y(\Delta t) = y(t=0) + \Delta t \left(\frac{dy}{dt}\bigg|_{t=0} + \frac{\Delta t}{2} \frac{d^2}{dt^2}\bigg|_{t=0} + ... \right)
\end{align}\]</div>
<p>Last full term is the approximation of mid-point slope. Thus, mid-point method is an <span class="math notranslate nohighlight">\(O(\Delta t^2)\)</span> method without using any information from the second derivative. Proposed process:</p>
<div class="amsmath math notranslate nohighlight" id="equation-b5d92d5e-9168-41a4-b284-b1bb57be61cf">
<span class="eqno">(366)<a class="headerlink" href="#equation-b5d92d5e-9168-41a4-b284-b1bb57be61cf" title="Permalink to this equation">#</a></span>\[\begin{align}
y_{N+\frac{1}{2}} = y_N + \frac{\Delta t}{2} \frac{dy}{dt}\bigg|_N\\
y_{N+1} = y_N + \Delta t \frac{dy}{dt}\bigg|_{N+\frac{1}{2}}
\end{align}\]</div>
<p><span class="math notranslate nohighlight">\(\underline{\text{Ex}}\)</span>:  <span class="math notranslate nohighlight">\(\frac{dy}{dt} = -y, \hspace{1cm} y(t=0)=1\)</span></p>
<div class="amsmath math notranslate nohighlight" id="equation-be970fd7-2888-4807-86f9-057324984005">
<span class="eqno">(367)<a class="headerlink" href="#equation-be970fd7-2888-4807-86f9-057324984005" title="Permalink to this equation">#</a></span>\[\begin{align}
y_{N+\frac{1}{2}} = 1 + \frac{\Delta t}{2} \frac{dy}{dt}\bigg|_{t=0} = 1 - \frac{\Delta t}{2}\\
y_{N+1} = 1 + \Delta t \left(- \left(1 - \frac{\Delta t}{2} \right) \right) = 1 - \Delta t \left(1 - \frac{\Delta t}{2} \right) 
\end{align}\]</div>
<section id="python-implementation-of-the-mid-point-method">
<h3>Python implementation of the mid-point method<a class="headerlink" href="#python-implementation-of-the-mid-point-method" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">midpoint_integrate</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">y0</span><span class="p">):</span>
  <span class="c1"># func: the function to integrate, of the form</span>
  <span class="c1">#       y&#39;=F(t,y)</span>
  <span class="c1"># y0:   the initial function value</span>
  <span class="c1"># t:    the range of times to evaluate</span>

  <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">y0</span><span class="p">]</span>
  <span class="n">dt</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

  <span class="c1">#Loop through and implement the update</span>
  <span class="k">for</span> <span class="n">new_time</span> <span class="ow">in</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>

    <span class="n">current_y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1">#Get the current derivative</span>
    <span class="n">yprime</span><span class="o">=</span><span class="n">func</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">current_y</span><span class="p">)</span>

    <span class="c1">#Get the mid-point</span>
    <span class="n">yN12</span><span class="o">=</span> <span class="n">current_y</span> <span class="o">+</span> <span class="n">yprime</span> <span class="o">*</span> <span class="n">dt</span><span class="o">/</span><span class="mi">2</span>

    <span class="c1">#Get the derivative at the mid-point</span>
    <span class="n">yprimeN12</span><span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="n">dt</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">yN12</span><span class="p">)</span> <span class="c1"># fill this in</span>

    <span class="c1">#Take the full step</span>
    <span class="n">updated_y</span><span class="o">=</span> <span class="n">current_y</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">yprimeN12</span> <span class="c1"># fill this in</span>

    <span class="c1">#Save the y</span>
    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">updated_y</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">y</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.1</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">euler_integrate</span><span class="p">(</span><span class="n">yprime</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;1st-order Euler Sol&#39;&#39;n&#39;</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">euler_2nd_derivative_integrate</span><span class="p">(</span><span class="n">yprime_yprimeprime</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;or&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;2nd-order Euler Sol&#39;&#39;n&#39;</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">midpoint_integrate</span><span class="p">(</span><span class="n">yprime</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;ob&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mid-point method Sol&#39;&#39;n&#39;</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">),</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;full solution, $e^{-t}$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f344859a510&gt;
</pre></div>
</div>
<img alt="../../_images/15-springs-numerical-odes_48_1.png" src="../../_images/15-springs-numerical-odes_48_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Scan over a range of time steps</span>

<span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mf">.5</span><span class="p">,</span><span class="mf">.1</span><span class="p">,</span><span class="mf">.05</span><span class="p">,</span><span class="mf">.01</span><span class="p">]:</span>

  <span class="c1"># Calculate the solution</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.01</span><span class="p">,</span><span class="n">dt</span><span class="p">)</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">euler_integrate</span><span class="p">(</span><span class="n">yprime</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

  <span class="c1"># Plot the error (difference beteween analytical </span>
  <span class="c1"># solution and numerical solution)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span><span class="s1">&#39;ok&#39;</span><span class="p">)</span>

  <span class="c1"># Calculate the solution</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">euler_2nd_derivative_integrate</span><span class="p">(</span><span class="n">yprime_yprimeprime</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

  <span class="c1"># Plot the error (difference beteween analytical </span>
  <span class="c1"># solution and numerical solution)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span><span class="s1">&#39;or&#39;</span><span class="p">)</span>

  <span class="c1"># Calculate the solution</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">midpoint_integrate</span><span class="p">(</span><span class="n">yprime</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

  <span class="c1"># Plot the error (difference beteween analytical </span>
  <span class="c1"># solution and numerical solution)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])),</span><span class="s1">&#39;ob&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># Plot a simple -1 log scaling to show the error drops</span>
<span class="n">dt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="n">dt</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;First order Euler&#39;</span><span class="p">)</span>

<span class="n">dt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span><span class="n">dt</span><span class="o">**</span><span class="mf">2.</span><span class="o">/</span><span class="mi">20</span><span class="p">,</span><span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Euler with 2nd Derivatives, or Mid-Point&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time Step&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error at t=2 for y</span><span class="se">\&#39;</span><span class="s1">=-y, y(0)=2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f3447ee92d0&gt;
</pre></div>
</div>
<img alt="../../_images/15-springs-numerical-odes_49_1.png" src="../../_images/15-springs-numerical-odes_49_1.png" />
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="numerical-taylor-expansions">
<h1>Numerical Taylor expansions<a class="headerlink" href="#numerical-taylor-expansions" title="Permalink to this headline">#</a></h1>
<ul class="simple">
<li><p>We have a complicated function (based on info at one point) that we want to  approximate. The Taylor series is a polynomial approxiamation of <span class="math notranslate nohighlight">\(f\)</span>:</p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-0029b325-68b6-430c-b57b-4431e65d49e6">
<span class="eqno">(368)<a class="headerlink" href="#equation-0029b325-68b6-430c-b57b-4431e65d49e6" title="Permalink to this equation">#</a></span>\[\begin{align}
\hat{f} = a + bx + cx^2 + dx^3
\end{align}\]</div>
<p>The simplest approximation is <span class="math notranslate nohighlight">\(\hat{f} = a\)</span>. Let’s demonstrate with <span class="math notranslate nohighlight">\(f(x) = \exp(x)\)</span></p>
<ul class="simple">
<li><p>Each coefficient is obtained by matching derivatives</p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-6906b2e0-ff1a-456d-b0a6-61b50df60778">
<span class="eqno">(369)<a class="headerlink" href="#equation-6906b2e0-ff1a-456d-b0a6-61b50df60778" title="Permalink to this equation">#</a></span>\[\begin{align}
\hat{f}(x=0) = a = f(x=0)\\
\frac{d\hat{f}}{dx}\bigg|_{x=0} = b = \frac{df}{dx}\bigg|_{x=0}\\
\frac{d^2\hat{f}}{dx^2}\bigg|_{x=0} = 2c = \frac{d^2}{dx^2}\bigg|_{x=0}
\end{align}\]</div>
<p>And so on..</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">f2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">x</span>
<span class="n">f3</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">f4</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">6</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;$\hat</span><span class="si">{f}</span><span class="s1">$ = 1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;$\hat</span><span class="si">{f}</span><span class="s1"> = 1 + x$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f3</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;$\hat</span><span class="si">{f}</span><span class="s1"> = 1 + x + x^2 / 2$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f4</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;$\hat</span><span class="si">{f}</span><span class="s1"> = 1 + x + x^2/2 + x^3/6$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;exp(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/15-springs-numerical-odes_51_0.png" src="../../_images/15-springs-numerical-odes_51_0.png" />
</div>
</div>
<section id="example-of-taylor-expansion-in-python">
<h2>Example of taylor expansion in python<a class="headerlink" href="#example-of-taylor-expansion-in-python" title="Permalink to this headline">#</a></h2>
<p>Rather than explicitly coding the Taylor expansion, let’s make a little function to do this for us.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">factorial</span>

<span class="k">def</span> <span class="nf">taylor_exp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
  <span class="c1"># this function evaluates the taylor expansion of exp(x)</span>

  <span class="c1"># x is a range of x to evaluate at</span>
  <span class="c1"># N is the order of the taylor expansion</span>

  <span class="n">y</span><span class="o">=</span><span class="mf">0.0</span>

  <span class="c1"># Loop over N, adding terms </span>
  <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
      <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="n">n</span><span class="o">/</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

  <span class="c1"># return the final approximation to y</span>
  <span class="k">return</span> <span class="n">y</span>

<span class="c1">#Test the function for x=2 at order 1    </span>
<span class="n">taylor_exp</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">N</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.266666666666667
</pre></div>
</div>
</div>
</div>
<p>Using this function, we plot the the curves from before.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Choose 100 points to evaluate</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># For each order 1 to 5, compute teh approximation and plot</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">):</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">taylor_exp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">),</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;taylor series order </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="k">n</span>)

<span class="c1"># Plot the known (analytical exp(x) ) expression</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;exp(x)&#39;</span><span class="p">)</span>

<span class="c1"># Add x/y labels and legend</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;f=exp(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f344b9f7c90&gt;
</pre></div>
</div>
<img alt="../../_images/15-springs-numerical-odes_55_1.png" src="../../_images/15-springs-numerical-odes_55_1.png" />
</div>
</div>
<p>There’s even a scipy function that will estimate the polynomial terms in the Taylor expansion at a point for an arbitrary function!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">approximate_taylor_polynomial</span> 

<span class="c1"># Choose 100 points to evaluate</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">myfunc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># For each order 1 to 5, compute teh approximation and plot</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">):</span>
  <span class="n">p</span> <span class="o">=</span> <span class="n">approximate_taylor_polynomial</span><span class="p">(</span><span class="n">myfunc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;taylor series order </span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># Plot the known (analytical exp(x) ) expression</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">myfunc</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;sin(x)exp(x)&#39;</span><span class="p">)</span>

<span class="c1"># Add x/y labels and legend</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;f=np.sin(x)*np.exp(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f344ba04f90&gt;
</pre></div>
</div>
<img alt="../../_images/15-springs-numerical-odes_57_1.png" src="../../_images/15-springs-numerical-odes_57_1.png" />
</div>
</div>
<p>The Taylor expansion is an approximation to the true solution. Clearly, the answer at <span class="math notranslate nohighlight">\(x=2\)</span> gets better as the order of the approximation increases. Let’s plot the difference between the true solution and the approximation for various order n</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">=</span><span class="mi">2</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">30</span><span class="p">):</span>
  <span class="c1">#Calculate the difference between the true solution and approximate solution at x=2</span>
  <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">taylor_exp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>

  <span class="c1">#plot the error</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">error</span><span class="p">,</span><span class="s1">&#39;ok&#39;</span><span class="p">)</span>

<span class="c1"># add x/y labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Terms in Taylor Series&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Error in Taylor approx, abs[f(x=2)-exp(x=2)]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Error in Taylor approx, abs[f(x=2)-exp(x=2)]&#39;)
</pre></div>
</div>
<img alt="../../_images/15-springs-numerical-odes_59_1.png" src="../../_images/15-springs-numerical-odes_59_1.png" />
</div>
</div>
<ul class="simple">
<li><p>Notice how the error gets smaller and smaller as the number of points goes.</p></li>
<li><p>However, this only works so far, and eventually the error saturates. This is because of how numbers are stored in a computer. Floating point numbers are stored as (on a 32-bit computer):</p></li>
</ul>
<div class="amsmath math notranslate nohighlight" id="equation-128a049f-d06f-4c72-b1a5-907db7cf98f5">
<span class="eqno">(370)<a class="headerlink" href="#equation-128a049f-d06f-4c72-b1a5-907db7cf98f5" title="Permalink to this equation">#</a></span>\[\begin{align}
1.362597134568123 \times 10^{+36} &amp;&amp; \text{(15 decimal places and power of 10)}
\end{align}\]</div>
<ul class="simple">
<li><p>Since there’s only 16 demical places, we can’t really get any more accurate than that.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notes/ordinary_differential_equations"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="14-MoUC-VoP.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Method of Undetermined Coefficients (sec 2.9)</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="16-coupled-odes.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Coupled Differential Equations</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Zachary Ulissi<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>